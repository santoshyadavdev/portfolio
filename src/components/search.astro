---
import { useState, useEffect } from 'react';
import lunr from 'lunr';

const Search = () => {
  const [query, setQuery] = useState('');
  const [results, setResults] = useState([]);
  const [index, setIndex] = useState(null);

  useEffect(() => {
    const fetchData = async () => {
      const response = await fetch('/search-index.json');
      const data = await response.json();
      const idx = lunr(function () {
        this.ref('id');
        this.field('title');
        this.field('content');

        data.forEach((doc) => {
          this.add(doc);
        });
      });
      setIndex(idx);
    };

    fetchData();
  }, []);

  const handleSearch = (event) => {
    const query = event.target.value;
    setQuery(query);

    if (index) {
      const results = index.search(query).map(({ ref }) => {
        return data.find((doc) => doc.id === ref);
      });
      setResults(results);
    }
  };

  return (
    <div>
      <input
        type="text"
        value={query}
        onChange={handleSearch}
        placeholder="Search..."
      />
      <ul>
        {results.map((result) => (
          <li key={result.id}>
            <a href={result.url}>{result.title}</a>
          </li>
        ))}
      </ul>
    </div>
  );
};

export default Search;
